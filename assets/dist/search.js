!function(){"use strict";const e=document.querySelector(".cas-search-form"),t={search:document.getElementById("cas-search-submit"),clear:document.getElementById("cas-search-close"),loading:document.getElementById("cas-search-loader")};function n(e){Object.values(t).forEach((e=>{e&&(e.style.display="none")})),t[e]?t[e].style.display="inline-block":console.warn(`Неизвестное состояние кнопки: ${e}`)}const c=document.getElementById("cas-search-close");let a="search";function s(){n(a)}let r="",o="",i=!1,l=!1,u=!1;function d(){let{resetLastStable:e=!0,resetInitial:t=!0,resetCleared:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&(r=""),t&&(o=""),n&&(i=!0)}function m(e){l=e}function f(){return l}function h(){return r}function y(e){u=e}function v(e){e.innerHTML=""}function g(e){""!==e.innerHTML.trim()&&(e.style.display="block")}function E(e){setTimeout((()=>{e.style.display="none"}),300)}function p(e,t){!e.trim()||e.length<=3?v(t):f()||(m(!0),a="inline-block"===c.style.display?"clear":"search",n("loading"),fetch(cas_ajax.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({action:"cas_ajax_search",search:e,nonce:cas_ajax.nonce})}).then((e=>e.json())).then((e=>{m(!1),s(),v(t),e.success&&e.data.length>0?(t.innerHTML=e.data.map((e=>`<li><a href="${e.link}">${e.title}</a><p>${e.excerpt}</p></li>`)).join(""),g(t)):(t.innerHTML="<li>Нет результатов</li>",g(t))})).catch((e=>{m(!1),s(),console.error("Search error:",e)})))}const L=document.getElementById("cas-search");function k(e){return e.replace(/\s+/g,"").toLowerCase()}function B(){L.blur()}let I;function T(e,t){e.addEventListener("input",(c=>function(e,t,c){if(f())return e.preventDefault(),void(t.value=h());clearTimeout(I);const a=t.value.trim();if(""===a)return d({resetInitial:!1}),v(c),E(c),void n("search");a.length<=3&&d(),a.length<=3&&0!==c.querySelectorAll("li").length&&(m(!1),v(c),E(c)),i&&(o=a,i=!1),k(a)!==k(h())&&(n(a.length>0?"clear":"search"),a.length<3||(I=setTimeout((()=>{if(!f()){if(u)return;if(k(a)===k(h()))return;p(a,c),r=a}}),700)))}(c,e,t))),e.addEventListener("cut",(c=>function(e,t,c){f()?e.preventDefault():setTimeout((()=>{""===t.value.trim()&&(v(c),E(c),n("search"))}),10)}(c,e,t))),e.addEventListener("click",(()=>function(e){g(e)}(t))),e.addEventListener("keydown",(e=>function(e){"Backspace"===e.key&&y(!0)}(e))),e.addEventListener("keyup",(e=>function(e){"Backspace"===e.key&&y(!1)}(e)))}const b=document.getElementById("cas-search"),w=document.getElementById("cas-search-close");const j=document.getElementById("cas-search-submit");function S(){const t=document.querySelector(".cas-search-form"),c=document.getElementById("cas-search-results");!function(e){T(b,e)}(c),function(t){j.addEventListener("click",(c=>{c.preventDefault(),e.classList.add("active"),n("clear"),document.getElementById("cas-search").focus(),""!==document.getElementById("cas-search").value.trim()&&p(document.getElementById("cas-search").value,t)}))}(c),function(t){function c(c){c&&c.preventDefault(),clearTimeout(void 0),m(!1),B(),e.classList.remove("active"),f()||(d(),function(e){e.value=""}(b),clearTimeout(void 0)),o="",v(t),E(t),n("search")}w.addEventListener("click",c),document.addEventListener("keydown",(e=>{"Escape"!==e.key||f()||c()}))}(c),document.addEventListener("click",(e=>{t.contains(e.target)||c.contains(e.target)||(B(),E(c))}))}document.addEventListener("DOMContentLoaded",(()=>{S()}))}();